#!/bin/bash
if [[ -z $1 ]]; then
    echo "Usage:  "`basename $0`" <swift-container> <filename> ..."
    echo "        "`basename $0`" <swift-container>"
    exit
fi
CONTAINER=$1
shift 1
FILENAMES="$*"            # if no files given, it means list the container
# echo "Uploading: $FILENAMES"
# exit
# get these from the relevant sl portal object store page
DC=tor01 # or sjc01, tor01, etc... check with SL website
OBJECTSTORE="IBMOS729515-2"
PUB_ENDPOINT="https://$DC.objectstorage.softlayer.net/auth/v1.0/"
PRI_ENDPOINT="https://$DC.objectstorage.service.networklayer.com/auth/v1.0/"
USERNAME="$OBJECTSTORE:$SL_USERNAME"
APIKEY=$SL_API_KEY
export ST_AUTH=$PRI_ENDPOINT
export ST_AUTH=$PUB_ENDPOINT
export ST_USER=$USERNAME
export ST_KEY=$APIKEY
if [[ -n $FILENAMES ]]; then
    for f in $FILENAMES; do
        echo "delete $CONTAINER $f"
        swift delete $CONTAINER $f 2>/dev/null
        echo "upload $CONTAINER $f"
        swift upload $CONTAINER $f
    done
fi
if [[ -n $FILENAMES ]]; then
    echo "list $CONTAINER"
    swift list $CONTAINER -l
    # only run if your want https read access
    swift post -r ".r:*" $CONTAINER
else
    FILENAMES=`swift list $CONTAINER`
fi
URL=$(swift stat -v | grep StorageURL | head -1 | awk '{print $NF}')
for f in $FILENAMES; do
    echo "URL: $URL/$CONTAINER/$f"
done
